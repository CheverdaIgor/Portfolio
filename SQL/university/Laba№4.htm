<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>СУБД MSSQL</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
<META content="MSHTML 6.00.2800.1106" name=GENERATOR></HEAD>
<BODY style="BACKGROUND: lightgreen">
<CENTER>
<H3>Лабораторная работа 4</H3></CENTER>
<HR>

<CENTER>
<H3></H3>
<P></CENTER>
<P>
<DL>
  <DT><B>Цель:</B> научиться создавать разные виды триггеров для обеспечения целостности базы данных.

<P>  <CENTER><DT><font size="4"><B>Порядок выполнения работы:</B> </font></P></CENTER>
 
  <OL>
<LI>
Прежде чем пытаться писать триггеры, необходимо открыть созданную ранее диаграмму и в ней убрать все связи между таблицами базы данных, поскольку автоматическое отслеживание целостности информации мы обеспечим действиями, выполняемыми триггерами.
</LI>
    <LI>Для создания триггера нужно в своей базе данных перейти на закладку <I><B>Tables</B></I>. Далее 
      выбрать таблицу, для которой будет создан триггер, щелкнуть по ней 
      правой кнопкой мыши и из контекстного меню выбрать пункт <I><B>All tasks (Все задачи)-&gt; Manage triggers...</B></I>. 
      В появившемся окне выберите имя триггера <I><B>New</B></I> для создания нового триггера. Начало триггера выглядит следующим образом:
<br>
      CREATE TRIGGER [trigger_name] ON [table] <BR>FOR 
      DELETE,INSERT,UPDATE<BR>AS
<BR>... А вот выполняемые триггером действия надлежит описать Вам. Итак,...
<LI>Создать триггер на добавление новой записи в таблицу <I><B>STUFF</B></I>:
необходимо проверить, существует ли в таблице <I><B>MATERIALS</B></I> код соответствующего материала, 
и если не существует, то добавляемая в таблицу <I><B>STUFF</B></I> запись удаляется. (При написании 
триггера следует работать с таблицей <I><B>INSERTED</B></I>.)
</LI>
<LI>Создать триггер на добавление новой записи в таблицу <I><B>SALES</B></I>:
необходимо проверить, существует ли в таблице <I><B>STUFF</B></I> код соответствующего изделия
 и в таблице <I><B>CUSTOMERS</B></I> код соответствующего покупателя, 
и если не существует первого либо второго кодов, то добавляемая в таблицу <I><B>SALES</B></I> 
запись удаляется. (При написании триггера следует работать с таблицей <I><B>INSERTED</B></I>.)
</LI>
<LI>Создать триггер на добавление новой записи в таблицу <I><B>PURCHASE</B></I>:
необходимо проверить, существует ли в таблице <I><B>MATERIALS</B></I> код соответствующего материала
 и в таблице <I><B>PROVIDERS</B></I> код соответствующего поставщика, 
и если не существует кода материала либо кода поставщика, то добавляемая в таблицу <I><B>PURCHASE</B></I> 
запись удаляется. (При написании триггера следует использовать таблицу <I><B>INSERTED</B></I>.)
</LI>
<LI>Создать триггер на удаление записи из таблицы <I><B>PROVIDERS</B></I>: если удаляется запись о
 поставщике, то должно происходить удаление всех записей, касающихся данного поставщика в таблице
<I><B>PURCHASE</B></I>. (При написании триггера следует использовать таблицу <I><B>DELETED</B></I>.)
</LI>
<LI>Создать триггер на удаление записи из таблицы <I><B>CUSTOMERS</B></I>: если удаляется запись о
 покупателе, то должны удаляться все записи с упоминанием этого покупателя из таблицы
<I><B>SALES</B></I>. (При написании триггера следует использовать таблицу <I><B>DELETED</B></I>.)
</LI>
<LI>Создать триггер на удаление записи из таблицы <I><B>STUFF</B></I>: если удаляется запись о
 продаваемом изделии, то нужно удалить все записи о продажах этого изделия в таблице
<I><B>SALES</B></I>. (При написании триггера следует использовать таблицу <I><B>DELETED</B></I>.)
</LI>
<LI>Создать триггер на удаление записи из таблицы  <I><B>STUFF</B></I>: если в таблице <I><B>STUFF</B></I>
больше нет записей с кодом удаленного материала (т.е. из данного материала не изготавливаются 
изделия), то из таблицы <I><B>MATERIALS</B></I> удаляется запись с кодом данного материала.
(При написании триггера следует использовать таблицу <I><B>DELETED</B></I>.) 
<LI>Проверить работоспособность всех триггеров!    
</LI></OL></DT></DL></BODY></HTML>
